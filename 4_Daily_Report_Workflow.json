{
  "name": "ğŸ“Š FSBO GÃ¼nlÃ¼k Rapor",
  "nodes": [
    {
      "parameters": {"rule": {"interval": [{"field": "cronExpression", "expression": "0 18 * * 1-6"}]}},
      "id": "schedule", "name": "â° Her GÃ¼n 18:00", "type": "n8n-nodes-base.scheduleTrigger",
      "typeVersion": 1.2, "position": [0, 0]
    },
    {
      "parameters": {
        "operation": "executeQuery",
        "query": "SELECT COUNT(*) as toplam_arama, SUM(CASE WHEN randevu_alindi THEN 1 ELSE 0 END) as randevu, SUM(maliyet) as maliyet, AVG(sure_saniye) as ort_sure FROM call_logs WHERE DATE(arama_baslangic) = CURRENT_DATE"
      },
      "id": "stats", "name": "ğŸ“ˆ Ä°statistikler", "type": "n8n-nodes-base.postgres",
      "typeVersion": 2.5, "position": [220, 0]
    },
    {
      "parameters": {
        "jsCode": "const s = $input.first().json;\nconst oran = s.toplam_arama > 0 ? ((s.randevu / s.toplam_arama) * 100).toFixed(2) : 0;\nconst rapor = `ğŸ“Š FSBO GÃœNLÃœK RAPOR\\nğŸ“… ${new Date().toLocaleDateString('tr-TR')}\\n\\nğŸ“ Toplam Arama: ${s.toplam_arama}\\nâœ… Randevu: ${s.randevu}\\nğŸ¯ BaÅŸarÄ±: %${oran}\\nâ±ï¸ Ort. SÃ¼re: ${Math.round(s.ort_sure || 0)}sn\\nğŸ’° Maliyet: $${(s.maliyet || 0).toFixed(2)}`;\nreturn [{json: {report: rapor, stats: s}}];"
      },
      "id": "format", "name": "ğŸ“ Rapor OluÅŸtur", "type": "n8n-nodes-base.code",
      "typeVersion": 2, "position": [440, 0]
    },
    {
      "parameters": {"channel": "#emlak-raporlar", "text": "={{ $json.report }}"},
      "id": "slack", "name": "ğŸ“¢ Slack", "type": "n8n-nodes-base.slack",
      "typeVersion": 2.2, "position": [660, 0]
    },
    {
      "parameters": {
        "fromEmail": "rapor@firma.com", "toEmail": "yonetim@firma.com",
        "subject": "=ğŸ“Š FSBO Rapor - {{ $now.format('dd.MM.yyyy') }}",
        "message": "={{ $json.report }}"
      },
      "id": "email", "name": "ğŸ“§ Email", "type": "n8n-nodes-base.emailSend",
      "typeVersion": 2.1, "position": [660, 150]
    }
  ],
  "connections": {
    "â° Her GÃ¼n 18:00": {"main": [[{"node": "ğŸ“ˆ Ä°statistikler", "type": "main", "index": 0}]]},
    "ğŸ“ˆ Ä°statistikler": {"main": [[{"node": "ğŸ“ Rapor OluÅŸtur", "type": "main", "index": 0}]]},
    "ğŸ“ Rapor OluÅŸtur": {"main": [[{"node": "ğŸ“¢ Slack", "type": "main", "index": 0}], [{"node": "ğŸ“§ Email", "type": "main", "index": 0}]]}
  }
}
